<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Ogaboss Admin - Test Password Reset</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <style>
    body { font-family: 'Inter', sans-serif; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); }
    .logo { width: 60px; height: 60px; }
  </style>
</head>
<body class="min-h-screen flex items-center justify-center p-4">
  <div class="max-w-md w-full bg-white rounded-2xl shadow-2xl overflow-hidden">
    <!-- Header -->
    <div class="bg-gradient-to-r from-purple-600 to-indigo-600 p-8 text-center">
      <img src="https://ik.imagekit.io/o59kpgo8iz/Backbone/logo/rounded_logo.png" alt="Ogaboss Logo" class="logo mx-auto mb-4 rounded-full border-4 border-white shadow-lg"/>
      <h1 class="text-3xl font-bold text-white">Ogaboss Admin</h1>
      <p class="text-purple-100 mt-2">Password Reset Testing Tool</p>
    </div>

    <!-- Form Container -->
    <div class="p-8 space-y-8">
      <!-- Step 1: Forgot Password -->
      <div id="forgotForm" class="space-y-6">
        <div>
          <h2 class="text-2xl font-semibold text-gray-800">Forgot Password</h2>
          <p class="text-gray-600 mt-2">Enter your admin email to receive a reset link</p>
        </div>

        <div>
          <label class="block text-sm font-medium text-gray-700 mb-2">Admin Email</label>
          <input
            id="emailInput"
            type="email"
            value="admin@ogaboss.finance"
            class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent transition"
            placeholder="admin@yourapp.com"
          />
        </div>

        <button
          onclick="sendForgotPassword()"
          class="w-full bg-purple-600 hover:bg-purple-700 text-white font-bold py-4 rounded-lg transition transform hover:scale-105 active:scale-95"
        >
          Send Reset Link
        </button>

        <div id="forgotResult" class="mt-4 p-4 rounded-lg hidden"></div>
      </div>

      <!-- Step 2: Reset Password -->
      <div id="resetForm" class="space-y-6 hidden">
        <div>
          <h2 class="text-2xl font-semibold text-gray-800">Set New Password</h2>
          <p class="text-gray-600 mt-2">Enter the token from email and your new password</p>
        </div>

        <div>
          <label class="block text-sm font-medium text-gray-700 mb-2">Reset Token (from email URL)</label>
          <input
            id="tokenInput"
            type="text"
            class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent"
            placeholder="eyJhbGciOiJIUzI1NiIsInR5cCI6..."
          />
        </div>

        <div>
          <label class="block text-sm font-medium text-gray-700 mb-2">New Password</label>
          <input
            id="newPassword"
            type="password"
            class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent"
            placeholder="Enter strong password"
          />
        </div>

        <div class="flex gap-3">
          <button
            onclick="resetPassword()"
            class="flex-1 bg-green-600 hover:bg-green-700 text-white font-bold py-4 rounded-lg transition"
          >
            Reset Password
          </button>
          <button
            onclick="goBack()"
            class="flex-1 bg-gray-500 hover:bg-gray-600 text-white font-bold py-4 rounded-lg transition"
          >
            Back
          </button>
        </div>

        <div id="resetResult" class="mt-4 p-4 rounded-lg hidden"></div>
      </div>
    </div>

    <!-- Footer -->
    <div class="bg-gray-50 px-8 py-6 text-center text-sm text-gray-600 border-t">
      <p>Environment: <span id="env" class="font-mono font-bold text-purple-600">Unknown</span></p>
      <p class="mt-2">Base URL: <span id="baseUrl" class="font-mono text-xs bg-gray-200 px-2 py-1 rounded"></span></p>
    </div>
  </div>

  <script>
    // CHANGE THIS TO YOUR ACTUAL BACKEND URL
    const API_BASE = "http://localhost:5000/api/v1/auth"; // Change to your dev/staging/prod

    document.getElementById("baseUrl").textContent = API_BASE;
    document.getElementById("env").textContent = 
      API_BASE.includes("localhost") ? "Local" : 
      API_BASE.includes("dev") ? "Staging" : "Production";

    async function sendForgotPassword() {
      const email = document.getElementById("emailInput").value.trim();
      const resultDiv = document.getElementById("forgotResult");
      
      if (!email) {
        showResult(resultDiv, "Please enter an email", "error");
        return;
      }

      resultDiv.className = "mt-4 p-4 rounded-lg";
      resultDiv.innerHTML = '<p class="text-gray-600">Sending request...</p>';
      resultDiv.classList.remove("hidden");

      try {
        const res = await fetch(`${API_BASE}/admin/forgot-password`, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ email })
        });

        const data = await res.json();

        if (res.ok) {
          showResult(resultDiv, "Reset link sent! Check your email (and spam)", "success");
          setTimeout(() => {
            document.getElementById("forgotForm").classList.add("hidden");
            document.getElementById("resetForm").classList.remove("hidden");
          }, 2000);
        } else {
          showResult(resultDiv, data.message || "Failed to send reset link", "error");
        }
      } catch (err) {
        showResult(resultDiv, "Network error. Is backend running?", "error");
      }
    }

    async function resetPassword() {
      const token = document.getElementById("tokenInput").value.trim();
      const password = document.getElementById("newPassword").value;
      const resultDiv = document.getElementById("resetResult");

      if (!token || !password) {
        showResult(resultDiv, "Token and password required", "error");
        return;
      }

      resultDiv.className = "mt-4 p-4 rounded-lg";
      resultDiv.innerHTML = '<p class="text-gray-600">Resetting password...</p>';
      resultDiv.classList.remove("hidden");

      try {
        const res = await fetch(`${API_BASE}/admin/reset-password`, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ token, newPassword: password })
        });

        const data = await res.json();

        if (res.ok) {
          showResult(resultDiv, "Password reset successfully! You can now log in.", "success");
        } else {
          showResult(resultDiv, data.message || "Failed to reset password", "error");
        }
      } catch (err) {
        showResult(resultDiv, "Network error", "error");
      }
    }

    function goBack() {
      document.getElementById("resetForm").classList.add("hidden");
      document.getElementById("forgotForm").classList.remove("hidden");
      document.getElementById("resetResult").classList.add("hidden");
    }

    function showResult(div, message, type) {
      div.innerHTML = `<p class="${type === 'success' ? 'text-green-700 bg-green-50' : 'text-red-700 bg-red-50'} px-4 py-3 rounded-lg font-medium">${message}</p>`;
    }

    // Auto-fill token from URL (for easy testing)
    const urlParams = new URLSearchParams(window.location.search);
    const tokenFromUrl = urlParams.get("token");
    if (tokenFromUrl) {
      document.getElementById("tokenInput").value = tokenFromUrl;
      document.getElementById("forgotForm").classList.add("hidden");
      document.getElementById("resetForm").classList.remove("hidden");
    }
  </script>
</body>
</html>